{% extends 'base.html' %}
{% load static %}

{% block css %}
<link rel="stylesheet" href="{% static 'dashboard/css/add_products.css' %}">
{% endblock %}

{% block maincontent %}
<div class="main-content">
    <div class="success-msg" id="successMessage">
        Product has been successfully added to the marketplace!
    </div>
    
    <h1>Add New Product</h1>
    
    <form id="addProductForm">
        <div class="form-group">
            {{ form.name.label }}
            {{ form.name }}
        </div>
        
        <div class="form-group">
            {{ form.category.label }}
            {{ form.category }}
        </div>
        
        <div class="form-group">
            {{ form.price.label }}
            {{ form.price }}
        </div>
        
        <div class="form-group">
            {{ form.stock.label }}
            {{ form.stock }}
        </div>
        
        <div class="form-group">
            {{ form.description.label }}
            {{ form.description }}
        </div>
        
        <div class="form-group">
            {{ form.main_image.label }}
            <div class="image-upload">

                <p style="color: #666; font-size: 14px;">Upload up to 3 images. First image will be used as the main product image.</p>
                <div class="image-preview">
                    <div class="image-preview-img">
                        <div class="main-preview-box">Preview 1</div>
                        <br>
                        {{ form.main_image }}
                    </div>

                    <div class="image-preview-img">
                        <div class="preview-box1">Preview 2</div>
                        <br>
                        {{ form.image1 }}
                    </div>

                    <div class="image-preview-img">
                        <div class="preview-box2">Preview 3</div>
                        <br>
                        {{ form.image2 }}
                    </div>

                </div>
            </div>
        </div>
        
        <div class="form-group">
            {{ form.key_features.label }}
            {{ form.key_features }}
        </div>
        
        <div class="form-actions">
            <a href="{% url 'sellerdashboard' %}"><button type="button" class="btn btn-secondary">Cancel</button></a>
            <button type="submit" class="btn btn-primary">Add Product</button>
        </div>
    </form>
</div>

<script>
    // Simple preview functionality for demonstration
    document.getElementById('mainProductImage').addEventListener('change', function(e) {
        const previewBox = document.querySelector('.main-preview-box');
        const file = e.target.files[0]; // Fetch only the first image
        
        if (file) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                previewBox.innerHTML = '';
                const img = document.createElement('img');
                img.src = e.target.result;
                img.style.maxWidth = '100%';
                img.style.maxHeight = '100%';
                previewBox.appendChild(img);
            };
            
            reader.readAsDataURL(file);
        }
    });
    
    document.getElementById('productImage1').addEventListener('change', function(e) {
        const previewBox = document.querySelector('.preview-box1');
        const file = e.target.files[0]; // Fetch only the first image
        
        if (file) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                previewBox.innerHTML = '';
                const img = document.createElement('img');
                img.src = e.target.result;
                img.style.maxWidth = '100%';
                img.style.maxHeight = '100%';
                previewBox.appendChild(img);
            };
            
            reader.readAsDataURL(file);
        }
    });
    
    document.getElementById('productImage2').addEventListener('change', function(e) {
        const previewBox = document.querySelector('.preview-box2');
        const file = e.target.files[0]; // Fetch only the first image
        
        if (file) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                previewBox.innerHTML = '';
                const img = document.createElement('img');
                img.src = e.target.result;
                img.style.maxWidth = '100%';
                img.style.maxHeight = '100%';
                previewBox.appendChild(img);
            };
            
            reader.readAsDataURL(file);
        }
    });
    
    // Form submission handler
    document.getElementById('addProductForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Basic validation
        const requiredFields = document.querySelectorAll('[required]');
        let valid = true;
        
        requiredFields.forEach(field => {
            if (!field.value) {
                valid = false;
                field.style.borderColor = 'red';
            } else {
                field.style.borderColor = '#ddd';
            }
        });
        
        if (valid) {
            // Show success message
            document.getElementById('successMessage').style.display = 'block';
            
            // In a real implementation, you would submit the form data to the server here
            // Reset form after short delay
            setTimeout(() => {
                document.getElementById('addProductForm').reset();
                document.getElementById('successMessage').style.display = 'none';
                
                // Reset image previews
                const previewBoxes = document.querySelectorAll('.preview-box');
                previewBoxes.forEach(box => {
                    box.innerHTML = box.getAttribute('data-default') || 'Preview';
                });
            }, 3000);
        }
    });
</script>
{% endblock %}
